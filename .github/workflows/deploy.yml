name: Deploy to GitHub Pages

on:
  # main ë¸Œëœì¹˜ì— push í•  ë•Œ ì‹¤í–‰
  push:
    branches:
      - main
  # Actions íƒ­ì—ì„œ ìˆ˜ë™ìœ¼ë¡œ ì‹¤í–‰
  workflow_dispatch:

jobs:
  build_and_deploy:
    # ğŸš¨ **ì´ ë¶€ë¶„**ì„ ì¶”ê°€í•´ì•¼ í•©ë‹ˆë‹¤! ğŸš¨
    permissions:
      contents: write # ${{ secrets.GITHUB_TOKEN }}ì´ ë¸Œëœì¹˜ì— í‘¸ì‹œí•  ìˆ˜ ìˆë„ë¡ ì“°ê¸° ê¶Œí•œ ë¶€ì—¬

    runs-on: ubuntu-latest

    steps:
      # 1. GitHub Actionì—ì„œ ì‚¬ìš©í•  ì†ŒìŠ¤ ì½”ë“œë¥¼ ì²´í¬ì•„ì›ƒí•©ë‹ˆë‹¤.
      - name: Checkout
        uses: actions/checkout@v4

      # 2. Deno ì„¤ì¹˜ (deno bundle ì‚¬ìš©ì„ ìœ„í•´ v1 stable ìœ ì§€)
      - name: Install Deno
        uses: denoland/setup-deno@v2
        with:
          deno-version: v2.6.x
          cache: true
      - run: echo "Deno version is ${{ steps.deno.outputs.deno-version }}"

      # 3. Zola ì„¤ì¹˜
      - name: Install Zola
        uses: taiki-e/install-action@v2
        with:
          tool: zola

      # 4. ì›¹ì‚¬ì´íŠ¸ ë¹Œë“œ (TailwindCSS ë° Router ë²ˆë“¤ë§ í¬í•¨)
      - name: Build site
        run: deno task prd

      # 5. 'public' í´ë”ì˜ ë‚´ìš©ì„ GitHub Pagesì— ë°°í¬í•©ë‹ˆë‹¤.
      - name: Deploy
        uses: peaceiris/actions-gh-pages@v4
        with:
          github_token: ${{ secrets.GITHUB_TOKEN }}
          publish_dir: ./public
          commit_message: ${{ github.event.head_commit.message }}
