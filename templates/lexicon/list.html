{% extends "base.html" %}
{% import "macros/components/hero.html" as hero %}

{% block content %}
<main class="wrapper stack" style="--gap: var(--space-xxl)">
  {{
    hero::view(
    title="Lexicon",
    subtitle=config.extra.lexicon_subtitle | default(value="A structured index of core concepts and keywords."))
   }}

  <section class="lexicon-index stack" style="--gap: 0">
    <div class="separator">
      <span>A-Z INDEX</span>
    </div>

    <!-- Quick Jump Bar -->
    <nav class="cluster jump-bar" style="--gap: var(--space-sm)">
      {% set sorted_terms = terms | sort(attribute="name") %}
      {% set_global seen_letters = "" %}
      {% for term in sorted_terms %}
        {% set current_letter = term.name | truncate(length=1, end="") | upper %}
        {% if current_letter not in seen_letters %}
          <a href="#letter-{{ current_letter }}" class="btn btn-ghost" style="font-size: var(--font-size-xs); padding: var(--space-xs) var(--space-sm);">{{ current_letter }}</a>
          {% set_global seen_letters = seen_letters ~ current_letter %}
        {% endif %}
      {% endfor %}
    </nav>

    <div class="stack" style="--gap: var(--space-xl)">
      {% set_global last_letter = "" %}

      {% for term in sorted_terms %}
        {% set current_letter = term.name | truncate(length=1, end="") | upper %}
        {% if current_letter != last_letter %}
          {% if last_letter != "" %}
            </div></div> {# Close previous group #}
          {% endif %}
          <div class="index-group" id="letter-{{ current_letter }}">
            <span class="group-letter">{{ current_letter }}</span>
            <div class="terms-cluster">
          {% set_global last_letter = current_letter %}
        {% endif %}

        <a href="{{ term.permalink }}" class="term-link">
          <span class="term-name">{{ term.name }}</span>
          <span class="term-count">{{ term.pages | length }}</span>
        </a>

        {% if loop.last %}
          </div></div> {# Close final group #}
        {% endif %}
      {% endfor %}
    </div>
  </section>
</main>
{% endblock content %}
