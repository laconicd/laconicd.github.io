{#
############################################################################
###  [ ðŸ“‹ SECTION: DOCUMENT HEAD & METADATA ]
############################################################################
#}

{% macro link() %}
  <link rel="icon" type="image/svg+xml" href="{{ get_url(path='images/avatar.svg') | safe }}" />
  <link
    rel="preload"
    href="{{ get_url(path='fonts/outfit/outfit-latin-wght-normal.woff2') | safe }}"
    as="font"
    type="font/woff2"
    crossorigin
  />
  <link rel="stylesheet" href="{{ get_url(path='styles/main.css', cachebust=true) | safe }}" />
  <link
    rel="alternate"
    type="application/atom+xml"
    title="Atom Feed"
    href="{{ get_url(path='atom.xml', trailing_slash=false) }}"
  />
  <link
    rel="alternate"
    type="application/rss+xml"
    title="RSS Feed"
    href="{{ get_url(path='rss.xml', trailing_slash=false) }}"
  />
{% endmacro %}

{% macro script() %}
  <script type="speculationrules">
    { "prerender": [{ "where": { "href_matches": "/*" }, "eagerness": "moderate" }] }
  </script>

  <script>
    window.__SYNTAX_THEME_URLS__ = {
      dim: "{{ get_url(path='giallo-dark.css') | safe }}",
      lofi: "{{ get_url(path='giallo-light.css') | safe }}",
    };
  </script>

  <!-- theme.js must run early to prevent FOUC -->
  <script>
    (function() {
      var s=class{themeAttr="data-theme";storageKey="theme";darkTheme="dim";lightTheme="lofi";constructor(){this.init()}init(){let e=this.getSavedTheme();document.documentElement.setAttribute(this.themeAttr,e),this.injectSyntaxTheme(e)}getSavedTheme(){let e=localStorage.getItem(this.storageKey);return e||(window.matchMedia("(prefers-color-scheme: dark)").matches?this.darkTheme:this.lightTheme)}injectSyntaxTheme(e){let i=window.__SYNTAX_THEME_URLS__||{},h=e===this.darkTheme?i.dim:i.lofi;if(!h||h===window.location.href)return;let t=document.createElement("link");t.id="syntax-theme",t.classList.add("js-syntax-theme"),t.rel="stylesheet",t.href=h,document.head.appendChild(t)}};new s;
    })();
  </script>
{% endmacro %}

{% macro seo(page=false, section=false, config=false, current_url=false) %}
  {% set current_url = current_url | default(value=config.base_url) %}
  {% set title = config.title %}
  {% set description = config.description %}
  {% set og_image = get_url(path=config.extra.default_image) %}

  {% if page %}
    {% set title = page.title %}
    {% set description = page.summary | default(value=page.description) | default(value=description) %}

    {% if page.extra.image %}
      {% set path_parts = page.relative_path | split(pat="/") %}
      {% set dir_path = path_parts | slice(end=-1) | join(sep="/") %}
      {% set image_path = "static/media/" ~ dir_path ~ "/" ~ page.extra.image %}
      {% set og_image_processed = resize_image(path=image_path, width=1200, height=630, op="fill") %}
      {% set og_image = og_image_processed.url %}
    {% endif %}
  {% elif section %}
    {% set title = section.title | default(value=title) %}
    {% set description = section.description | default(value=description) %}

    {% if section.extra.image %}
      {% set og_image = get_url(path=section.extra.image) %}
    {% endif %}
  {% endif %}

  {% set description = description | striptags | truncate(length=160) %}

  <title>{{ title }}</title>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <meta name="view-transition" content="same-origin" />
  <meta name="description" content="{{ description }}" />
  <meta property="og:type" content="website" />
  <meta property="og:url" content="{{ current_url | safe }}" />
  <meta property="og:title" content="{{ title }}" />
  <meta property="og:description" content="{{ description }}" />
  <meta property="og:image" content="{{ og_image | safe }}" />
  <meta property="twitter:card" content="summary_large_image" />
  <meta property="twitter:url" content="{{ current_url | safe }}" />
  <meta property="twitter:title" content="{{ title }}" />
  <meta property="twitter:description" content="{{ description }}" />
  <meta property="twitter:image" content="{{ og_image | safe }}" />
{% endmacro %}
