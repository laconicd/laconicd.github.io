{% extends "base.html" %}

{% block content %}
<article class="app-post">
  <!-- Post Header -->
  <header class="post-header">
    <div class="post-meta">
      {% if page.taxonomies.categories %}
        {% for cat in page.taxonomies.categories %}
          <span>{{ cat }}</span>
        {% endfor %}
        <span class="separator">â€¢</span>
      {% endif %}
      <time datetime="{{ page.date }}">{{ page.date | date(format=config.extra.date_format) }}</time>
    </div>

    <h1>{{ page.title }}</h1>

    <div class="post-author">
      <div class="author-avatar">
        <img src="{{ get_url(path=config.extra.author_avatar) | safe }}" alt="{{ config.extra.author_name }}" />
      </div>
      <div class="author-info">
        <span class="name">{{ config.extra.author_name }}</span>
        <span class="role">{{ config.extra.author_role }}</span>
      </div>
    </div>
  </header>

  <!-- Featured Image -->
  <div class="post-visual">
    {% if page.extra.image %}
      {% set path_parts = page.relative_path | split(pat="/") %}
      {% set dir_path = path_parts | slice(end=-1) | join(sep="/") %}
      {% set image_path = "static/media/" ~ dir_path ~ "/" ~ page.extra.image %}
      {% set resized = resize_image(path=image_path, width=1600, height=900, op="fill", format="webp") %}
      <img src="{{ resized.url }}" alt="{{ page.title }}" loading="eager" />
    {% else %}
      <img src="{{ get_url(path='images/default-post.jpg') }}" alt="{{ page.title }}" />
    {% endif %}
  </div>

  <!-- Content -->
  <div class="post-content">
    {{ page.content | safe }}
  </div>

  <!-- Share Section -->
  <section class="post-share-section">
    <div class="share-header">
      <span class="sub">Sharing is Caring</span>
      <h2 class="main">Enjoyed this post?</h2>
    </div>

    <div class="copy-card">
      <div class="url-display">
        {{ icons::link(size=5) }}
        <span class="url-text">{{ current_url | safe }}</span>
      </div>
      <button id="post-share-btn" class="copy-btn">
        <span class="label">Copy Link</span>
      </button>
    </div>

    <div class="social-actions">
      <a href="https://twitter.com/intent/tweet?url={{ current_url | safe }}&text={{ page.title }}" 
         target="_blank" rel="noopener noreferrer" class="action-item" title="Share on X">
        {{ icons::x(size=6) }}
      </a>

      <a href="{{ get_url(path='@/posts/_index.md') }}" class="action-item" title="Back to Archive">
        {{ icons::post(size=6) }}
      </a>

      <a href="/" class="action-item" title="Go Home">
        {{ icons::home(size=6) }}
      </a>
    </div>
  </section>

  <!-- Footer -->
  <footer class="post-footer">
    {% if page.taxonomies.tags %}
      <div class="post-tags">
        {% for tag in page.taxonomies.tags %}
          <a href="{{ get_taxonomy_url(kind='tags', name=tag) }}">
            #{{ tag }}
          </a>
        {% endfor %}
      </div>
    {% endif %}

    <nav class="post-navigation">
      {% if page.lower %}
        <a href="{{ page.lower.path }}" class="nav-card prev">
          <span class="nav-label">Previous Post</span>
          <span class="nav-title">{{ page.lower.title }}</span>
        </a>
      {% endif %}

      {% if page.higher %}
        <a href="{{ page.higher.path }}" class="nav-card next">
          <span class="nav-label">Next Post</span>
          <span class="nav-title">{{ page.higher.title }}</span>
        </a>
      {% endif %}
    </nav>
  </footer>

  <script>
    (function() {
      const shareBtn = document.getElementById('post-share-btn');
      const shareModal = document.getElementById('share_modal');
      if (shareBtn) {
        shareBtn.onclick = async () => {
          try {
            await navigator.clipboard.writeText(window.location.href);
            
            const label = shareBtn.querySelector('.label');
            const originalText = label.innerText;
            shareBtn.classList.add('copied');
            label.innerText = 'Copied!';
            
            if (shareModal && shareModal.showPopover) shareModal.showPopover();

            setTimeout(() => {
              shareBtn.classList.remove('copied');
              label.innerText = originalText;
            }, 2000);
          } catch (err) { 
            console.error(err);
          }
        };
      }
    })();
  </script>
</article>
{% endblock content %}
