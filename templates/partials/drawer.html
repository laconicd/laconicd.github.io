{% import "macros/icons.html" as icons %}
<div class="drawer drawer-end">
  <input id="mobile-drawer" type="checkbox" class="drawer-toggle" />
  <div class="drawer-side z-100">
    <label for="mobile-drawer" aria-label="close sidebar" class="drawer-overlay backdrop-blur-sm bg-base-900/10"></label>
    <nav class="menu p-4 w-80 min-h-full bg-base-100 text-base-content shadow-2xl flex flex-col">
      <div class="flex items-center justify-between mb-8 px-2">
        <span class="text-xl font-bold tracking-tight">{{ config.title }}</span>
        <label for="mobile-drawer" class="btn btn-ghost btn-circle btn-sm">
          {{ icons::close() }}
        </label>
      </div>
      <ul class="flex flex-col gap-2 flex-1">
        <li>
          <a href="{{ get_url(path='@/posts/_index.md') }}" class="flex items-center gap-4 py-3 px-4 rounded-xl hover:bg-base-200 transition-colors">
            {{ icons::post(class="opacity-60") }}
            <span class="font-medium text-lg">Posts</span>
          </a>
        </li>
        <li>
          <a href="{{ get_url(path='categories') }}" class="flex items-center gap-4 py-3 px-4 rounded-xl hover:bg-base-200 transition-colors">
            {{ icons::category(class="opacity-60") }}
            <span class="font-medium text-lg">Categories</span>
          </a>
        </li>
        <li>
          <a href="{{ get_url(path='tags') }}" class="flex items-center gap-4 py-3 px-4 rounded-xl hover:bg-base-200 transition-colors">
            {{ icons::tag(class="opacity-60") }}
            <span class="font-medium text-lg">Tags</span>
          </a>
        </li>

        <!-- Horizontal Divider -->
        <div class="divider my-4 opacity-50"></div>

        <li>
          <button id="drawer-search-btn" class="w-full flex items-center gap-4 py-3 px-4 rounded-xl hover:bg-base-200 transition-colors text-left">
            {{ icons::search(class="opacity-60") }}
            <span class="font-medium text-lg">Search</span>
          </button>
        </li>
        <li>
          <a href="{{ get_url(path='atom.xml') }}" target="_blank" class="flex items-center gap-4 py-3 px-4 rounded-xl hover:bg-base-200 transition-colors">
            {{ icons::atom(class="opacity-60") }}
            <span class="font-medium text-lg">Atom Feed</span>
          </a>
        </li>
        <li>
          <a href="{{ get_url(path='rss.xml') }}" target="_blank" class="flex items-center gap-4 py-3 px-4 rounded-xl hover:bg-base-200 transition-colors">
            {{ icons::rss(class="opacity-60") }}
            <span class="font-medium text-lg">RSS Feed</span>
          </a>
        </li>
        <li>
          <div class="flex items-center justify-between py-3 px-4 rounded-xl">
            <div class="flex items-center gap-4">
              {{ icons::sun(size=5, class="opacity-60") }}
              <span class="font-medium text-lg">Dark Mode</span>
            </div>
            <input type="checkbox" class="toggle toggle-primary theme-controller" value="dim" />
          </div>
        </li>
      </ul>
      <div class="mt-auto pt-6 border-t border-base-200 opacity-40 text-xs font-bold text-center uppercase tracking-widest">
        {{ config.title }} &copy; 2026
      </div>
    </nav>
  </div>

  <script>
    (function() {
      const setup = () => {
        const drawer = document.getElementById('mobile-drawer');
        const searchBtn = document.getElementById('drawer-search-btn');
        const searchModal = document.getElementById('search_modal');
        const navLinks = document.querySelectorAll('.drawer-side a[href]');

        if (drawer) {
          // Close drawer when links are clicked
          navLinks.forEach(link => {
            link.onclick = () => { drawer.checked = false; };
          });

          // Open search and close drawer
          if (searchBtn && searchModal) {
            searchBtn.onclick = () => {
              drawer.checked = false;
              searchModal.showModal();
            };
          }
        }
      };
      setup();
      window.addEventListener('page:updated', setup);
    })();
  </script>
</div>
